package jdbc.day01;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Scanner;

public class DQL_select_PreparedStatement_02 {

	public static void main(String[] args) {

		
		Connection conn = null;
		// Connection conn 은 데이터베이스 서버와 연결을 맺어주는 자바의 객체이다.
		
		PreparedStatement pstmt = null;
		//PreparedStatement pstmt 은 Connection conn(연결해서 사용할 DB 서버)에 전송할 SQL문(편지)을 전송(전달)을 해주는 객체(우편배달부)이다.
		
		ResultSet rs = null;
		//ResultSet rs은 select 되어진 결과물이 저장되어지는 곳.
		
		Scanner sc = new Scanner(System.in);

		
		try {
		// >>> 1. 오라클 드라이버 로딩 <<<
		/*
	        === OracleDriver(오라클 드라이버)의 역할 ===
	        1). OracleDriver 를 메모리에 로딩시켜준다.
	        2). OracleDriver 객체를 생성해준다.
	        3). OracleDriver 객체를 DriverManager에 등록시켜준다.
	            --> DriverManager 는 여러 드라이버들을 Vector 에 저장하여 관리해주는 클래스이다.
		*/
			Class.forName("oracle.jdbc.driver.OracleDriver");
			
			
			// >>> 2. 어떤 오라클 서버에 연결을 할래? <<<
			
			System.out.print(" 🫵연결할 오라클 서버의 IP 주소 : ");
			String ip = sc.nextLine(); // 127.0.0.1 //192.168.0.188 /191

			conn = DriverManager.getConnection("jdbc:oracle:thin:@" + ip + ":1521:xe", "JDBC_USER", "gclass");
			
			
			// >> 3.SQL문(편지)을 작성한다. <<
			String sql = " select no, name, msg, to_char(writeday, 'yyyy-mm-dd hh24:mi:ss') AS writeday " 
						+" from tbl_memo "
						+" order by no desc ";
			// SQL 문을 작성할 때 1줄 마다 앞, 뒤로 공백을 꼭 주도록 한다. !! 
			// ; 넣으면 오류

			// >>> 4. 연결할 오라클서버(conn)에 SQL문(편지)을 전달할 객체 PreparedStatement 객체 (우편배달부) 생성하기 <<<
			pstmt = conn.prepareStatement(sql);
			
			// >>> 5. PreparedStatement 객체 (우편배달부)는 작성도니 sql문(편지)을 오라클 서버에 보내서 실행이 되도록 해야 한다.
			rs = pstmt.executeQuery(); //sql문 실행
			
			/*
			 * SQL문이 DQL(select) 이므로 .executeQuery(); 을 사용해야 한다. 
			 */
			
			System.out.println("-".repeat(40));
			System.out.println("글본호\t글쓴이\t글내용\t작성일자");
			System.out.println("-".repeat(40));
			
			
			
			
		} catch (ClassNotFoundException e) {
			System.out.println(">>> ojdbc8.jar 파일이 없습니다. <<<");
		} catch(SQLException e) {
			e.printStackTrace();
		}
		
		
		
		
		
	}// end of main()-----------------------------

}
