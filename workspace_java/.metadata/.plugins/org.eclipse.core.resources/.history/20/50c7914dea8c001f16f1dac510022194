package jdbc.day04.board.controller;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Scanner;

import jdbc.day04.board.domain.BoardDTO;
import jdbc.day04.member.domain.CommentDTO;
import jdbc.day04.member.domain.MemberDTO;
import jdbc.day04.board.model.*;

public class BoardController {
	
	
	
	//field
	BoardDAO bdao = new BoardDAO_imple();
	
	
	
	//method
	//			ê²Œì‹œíŒ ë©”ë‰´	ë¥¼ ë³´ì—¬ì£¼ëŠ” ë©”ì†Œë“œ		//
	public void menu_Board(MemberDTO member, Scanner sc) {
		//â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
		boolean isExit= false;
		do {
			String add_menu = "admin".equals(member.getUserid())?"7.ìµœê·¼1ì£¼ì¼ê°„ ì¼ìë³„ ê²Œì‹œê¸€ ì‘ì„±ê±´ìˆ˜ \n8.ì´ë²ˆë‹¬ ì¼ìë³„ ê²Œì‹œê¸€ ì‘ì„±ê±´ìˆ˜   9.ë‚˜ê°€ê¸°\n":"7.ë‚˜ê°€ê¸° \n";
			
			System.out.println("\n--------------ê²Œì‹œíŒ ë©”ë‰´ [" + member.getName() + "ë‹˜ ë¡œê·¸ì¸ì¤‘..]------------------\n"
							+ "1.ê¸€ëª©ë¡ë³´ê¸°   2.ê¸€ë‚´ìš©ë³´ê¸°   3.ê¸€ì“°ê¸°   4.ëŒ“ê¸€ì“°ê¸° \n"
							+ "5.ê¸€ìˆ˜ì •í•˜ê¸°   6.ê¸€ì‚­ì œí•˜ê¸°   " + add_menu);
			
			System.out.print("ğŸ¤šë©”ë‰´ë²ˆí˜¸ ì„ íƒ : ");
			String s_menuNo = sc.nextLine();
			
			switch (s_menuNo) {
			case "1":	//ê¸€ëª©ë¡ë³´ê¸°
				boardList();
				break;
			case "2":	//ê¸€ë‚´ìš©ë³´ê¸°
				viewContents(member.getUserid(), sc);
				break;
			case "3":	//ê¸€ì“°ê¸°
				int n = write(member, sc);
				if(n==1)
					System.out.println(">> ê¸€ì“°ê¸° ì„±ê³µ!! <<");
				else if(n==0)
					System.out.println(">> ê¸€ì“°ê¸° ì·¨ì†Œ!! <<");
				else if(n== -1)
					System.out.println(">> ê¸€ì“°ê¸° ì‹¤íŒ¨!! <<");
				
				break;
			case "4":	//ëŒ“ê¸€ì“°ê¸°
				n = writeConmment(member, sc);
				
				if(n==1)
					System.out.println(">> ê¸€ì“°ê¸° ì„±ê³µ!! <<");
				else if(n==0)
					System.out.println(">> ê¸€ì“°ê¸° ì·¨ì†Œ!! <<");
				else if(n== -1)
					System.out.println(">> ê¸€ì“°ê¸° ì‹¤íŒ¨!! <<");
				
				break;
			case "5":	//ê¸€ìˆ˜ì •í•˜ê¸°
	
				break;
			case "6":	//ê¸€ì‚­ì œí•˜ê¸°
	
				break;
			case "7":	//ê´€ë¦¬ì(ìµœê·¼1ì£¼ì¼ê°„ ì¼ìë³„ ê²Œì‹œê¸€ ì‘ì„±ê±´ìˆ˜) ìœ ì €(ë‚˜ê°€ê¸°)
				if(!"admin".equals(member.getUserid())) 
					isExit = true;
				else {
					
				}
				break;
			case "8":	//ê´€ë¦¬ì ì¼ ë•Œ ì´ë²ˆë‹¬ ì¼ìë³„ ê²Œì‹œê¸€ ì‘ì„±ê±´ìˆ˜
				if("admin".equals(member.getUserid())) {
					break;
				}
			case "9":	//admin ì¼ë•Œ ë‚˜ê°€ê¸°
				if("admin".equals(member.getUserid())) {
					isExit = true;
					break;
				}
			default:
				System.out.println(">> ë©”ë‰´ì— ì—†ëŠ” ë²ˆí˜¸ ì…ë‹ˆë‹¤. <<");
				
				break;
			}// end of switch --------------------------------------
		}while (!isExit);
		//â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	}

	
	

	
	
	
	
	
	
	
	
	
	
	




	








	// *** ê¸€ì“°ê¸°ë¥¼ í•´ì£¼ëŠ” ë©”ì†Œë“œ *** //
	// === Transaction ì²˜ë¦¬ ===
	//    (tbl_board í…Œì´ë¸”ì— insert ê°€ ì„±ê³µë˜ì–´ì§€ë©´ tbl_member í…Œì´ë¸”ì˜ point ì»¬ëŸ¼ì— 10ì”© ì¦ê°€ update ë¥¼ í•  ê²ƒì´ë‹¤.
	//     ê·¸ëŸ°ë° insert ë˜ëŠ” update ê°€ í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ëª¨ë‘ rollback í•  ê²ƒì´ê³ ,
	//     insert ì™€ update ê°€ ëª¨ë‘ ì„±ê³µí•´ì•¼ë§Œ commit í•  ê²ƒì´ë‹¤.)
	private int write(MemberDTO member, Scanner sc) {
		
		int result = 0;
	
		System.out.println("âŒ‚âŒ‚âŒ‚âŒ‚âŒ‚ê¸€ì“°ê¸°âŒ‚âŒ‚âŒ‚âŒ‚âŒ‚");
		
		System.out.println("1. ì‘ì„±ìëª… : " + member.getName());
		
		System.out.print("2. ê¸€ì œëª© [ìµœëŒ€ 100ê¸€ì] : " );
		String subject = sc.nextLine();
		
		System.out.print("3. ê¸€ë‚´ìš© [ìµœëŒ€ 200ê¸€ì] : " );
		String contents = sc.nextLine();
		
		System.out.print("4. ê¸€ì•”í˜¸ [ìµœëŒ€ 20ê¸€ì] : " );
		String boardpasswd = sc.nextLine();
		
		
		BoardDTO bdto = new BoardDTO();
		bdto.setFk_userid(member.getUserid());
		bdto.setSubject(subject);
		bdto.setContents(contents);
		bdto.setBoardpasswd(boardpasswd);
		
		do {
			System.out.print(" ì •ë§ë¡œ ê¸€ì“°ê¸°ë¥¼ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?[Y/N] => ");
			String yn = sc.nextLine();
			
			if("y".equalsIgnoreCase(yn)) {
				int subject_length = subject.length();
				int contents_length = contents.length();
				int boardpasswd_length = boardpasswd.length();
				
				if((1<=subject_length && subject_length <=100) && (1<=contents_length && contents_length <=200) && (1<=boardpasswd_length && boardpasswd_length <=20))
				{
					result = bdao.write(bdto);
				}
				else {
					System.out.println(">> ì…ë ¥í•œ ë°ì´í„°ê°€ ë„ˆë¬´ í¬ë¯€ë¡œ ì…ë ¥ì´ ë¶ˆê°€í•©ë‹ˆë‹¤. <<");
				}
				
				break;
			}
			else if("n".equalsIgnoreCase(yn)) {
				break;
			}
			else {
				System.out.println("Y ë˜ëŠ” N ë§Œ ì…ë ¥í•˜ì„¸ìš”!! å–å–å–");
			}
		} while (true);
		return result;
	}
	
	
	//		ê¸€ëª©ë¡ë³´ê¸° í•´ì£¼ëŠ” ë©”ì†Œë“œ		//
	private void boardList() {
		
		List<BoardDTO> boardList = bdao.boardList();
		
		if(boardList.size() > 0) {
			//ê²Œì‹œê¸€ì´ ì¡´ì¬ í•˜ëŠ” ê²½ìš°
			StringBuilder sb = new StringBuilder();
			
			sb.append("\n" + "-".repeat(30) + " [ê²Œì‹œê¸€ ëª©ë¡] " + "-".repeat(35) + "\n");
			sb.append("ê¸€ë²ˆí˜¸\tê¸€ì œëª©\t\tì‘ì„±ì\tì‘ì„±ì¼ì\t\t\t\tì¡°íšŒìˆ˜\n");
			sb.append("-".repeat(75) +"\n");
			
			for(int i = 0; i<boardList.size(); i++) {
				sb.append(boardList.get(i).boardInfo() + "\n");
						//boardList.get(i) ëŠ” BoardDTO ì´ë‹¤
			}//end of for-----------------
			
			System.out.println(sb);
		}
		else {
			//ê²Œì‹œê¸€ì´ ì¡´ì¬ í•˜ì§€ ì•ŠëŠ” ê²½ìš°
			System.out.println("ê¸€ ëª©ë¡ì´ ì—†ì–´ã…¡ã…¡");
		}
		
		
	}//end of private void boardList() -----------------------------------
	
	
	
	//			ê¸€ ë‚´ìš©ë³´ê¸° í•´ì£¼ëŠ” ë©”ì†Œë“œ			//
	// == í˜„ì¬ ë¡œê·¸ì¸ ì‚¬ìš©ìê°€ ìì‹ ì´ ì“´ ê¸€ì„ ë³¼ë•ŒëŠ” ì¡°íšŒìˆ˜ ì¦ê°€ê°€ ì—†ì§€ë§Œ
	//    ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì“´ ê¸€ì„ ë³¼ë•ŒëŠ” ì¡°íšŒìˆ˜ë¥¼ 1ì¦ê°€ í•´ì£¼ì–´ì•¼ í•œë‹¤.
	private void viewContents(String login_userid, Scanner sc) {
		
		
		System.out.println("\n>>> ê¸€ë‚´ìš© ë³´ê¸° <<< ");
		
		System.out.print("ğŸ¤š ê¸€ë²ˆí˜¸ : ");
		String boardNo = sc.nextLine();
		
		Map<String, String> paraMap = new HashMap<>();
		paraMap.put("login_userid", login_userid);
		paraMap.put("boardNo", boardNo);
		
		BoardDTO bdto = bdao.viewContents(paraMap);
		
		if(bdto != null) {
			// ì¡´ì¬í•˜ëŠ” ê¸€ë²ˆí˜¸ë¥¼ ì…ë ¥í•œ ê²½ìš°
			System.out.println("[ê¸€ì œëª©] " + bdto.getSubject() + "\n"
							+ "[ê¸€ë‚´ìš©] " + bdto.getContents() + "\n"
							+ "[ì‘ì„±ì] " + bdto.getMbrdto().getName() + "\n"
							+ "[ì¡°íšŒìˆ˜] " + bdto.getViewcount());
		}
		else {
			// ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê¸€ë²ˆí˜¸ ë˜ëŠ” ê¸€ë²ˆí˜¸ë¥¼ ìˆ«ìê°€ ì•„ë‹Œ ë¬¸ìë¡œ ì…ë ¥í•œ ê²½ìš°
			System.out.println(">> ê¸€ë²ˆí˜¸ " + boardNo + "ì€(ëŠ”) ê¸€ ëª©ë¡ì— ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. << \n");
		}
		
	}//end of viewContentsâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	
	
	//			ëŒ“ê¸€ì“°ê¸° í•´ì£¼ëŠ” ë©”ì†Œë“œ			//
	private int writeConmment(MemberDTO member, Scanner sc) {
		
		int result = 0;
		
		System.out.println("\n>>> ëŒ“ê¸€ì“°ê¸° <<<");
		
		System.out.println("1. ì‘ì„±ìëª… : " + member.getName());
		
		System.out.print("2. ì›ê¸€ì˜ ê¸€ë²ˆí˜¸ : ");
		String s_fk_boardno = sc.nextLine();	// "ëŒë˜˜ì´"ì™€ ê°™ì€ ë¬¸ìê°€ ë“¤ì–´ì˜¤ë©´ ì•ˆëœë‹¤.!!
		
		String contents = null;
		int fk_boardno = 0;
		
		
		do {
		//â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
			try {
				fk_boardno = Integer.parseInt(s_fk_boardno);
				
				if(fk_boardno < 1) 
					System.out.println("!!!ğŸ¤šê²½ê³  ì›ê¸€ì˜ ê¸€ ë²ˆí˜¸ëŠ” 1 ì´ìƒì¸ ì •ìˆ˜ë¡œë§Œ ì…ë ¥í•˜ì…”ì•¼ í•´ìš”!!!");
				else
					break;
				
			} catch (NumberFormatException e) {
				System.out.println("!!!ğŸ¤šê²½ê³  ì›ê¸€ì˜ ê¸€ ë²ˆí˜¸ëŠ” ì •ìˆ˜ë¡œë§Œ ì…ë ¥í•˜ì…”ì•¼ í•´ìš”!!!");
			}
		//â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
		} while (true);
		
		
		do {
		//â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
			System.out.print("3. ëŒ“ê¸€ ë‚´ìš© : ");
			contents = sc.nextLine();
			
			/*
		        ëŒ“ê¸€ì˜ ë‚´ìš©ì„ ì…ë ¥í•  ë•Œ ê·¸ëƒ¥ ì—”í„°
		        ë˜ëŠ” ê³µë°±ë§Œìœ¼ë¡œ ì…ë ¥í•˜ê±°ë‚˜ 
		        ë˜ëŠ” tbl_comment í…Œì´ë¸”ì˜ contents ì»¬ëŸ¼ì˜ í¬ê¸°(ìµœëŒ€ 100ê¸€ì)ë³´ë‹¤ ë” ë§ì€ ê¸€ìë¥¼ ì…ë ¥í•˜ëŠ” ê²½ìš° 
			 */
			if(contents.isBlank()) {	//ê·¸ëƒ¥ ì—”í„° ë˜ëŠ” ê³µë°±ë§Œìœ¼ë¡œ ì…ë ¥í•œ ê²½ìš°
				System.out.println("!!!ğŸ¤šê²½ê³  ëŒ“ê¸€ ë‚´ìš©ì€ í•„ìˆ˜ë¡œ ì…ë ¥í•˜ì…”ì•¼ í•´ìš”!!!\n");
			}
			else if (contents.length() > 100) {
				System.out.println("!!!ğŸ¤šê²½ê³  ëŒ“ê¸€ ë‚´ìš©ì€ ìµœëŒ€ 100ê¸€ì ì´ë‚´ë¡œ ì…ë ¥í•˜ì…”ì•¼ í•´ìš”!!!\n");
			}
			else {
				break;
			}
		//â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
		} while (true);
		
		do {
		//â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
			System.out.print("ğŸ¤”ì •ë§ë¡œ ëŒ“ê¸€ ì“°ê¸°ë¥¼ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? [Y / N]\n");
			String yn = sc.nextLine();
			
			if("y".equalsIgnoreCase(yn)) {
				CommentDTO cdto = new CommentDTO();
				cdto.setContents(contents);
				result = bdao.writeComment();
				break;
			}
			else if("n".equalsIgnoreCase(yn)) {
				break;
			}
			else {
				
			}
		//â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
		} while(true);
		return result;
	}
	
	
	
}
