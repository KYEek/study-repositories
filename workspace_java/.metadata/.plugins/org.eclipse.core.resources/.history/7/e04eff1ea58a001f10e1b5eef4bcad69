package jdbc.day02;

import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.util.Scanner;

/*
 == ë¨¼ì € jdbc_day02.sql íŒŒì¼ì„ ì—´ì–´ì„œ tbl_class í…Œì´ë¸” ë° tbl_student í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤. 
   == ê·¸ë¦¬ê³  ì•„ë˜ì™€ ê°™ì´ ì˜¤ë¼í´ì—ì„œ í”„ë¡œì‹œì €ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤. ==
   
   >>>> Stored Procedure ë€? <<<<<
      Query ë¬¸ì„ í•˜ë‚˜ì˜ íŒŒì¼í˜•íƒœë¡œ ë§Œë“¤ê±°ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•´ ë†“ê³  í•¨ìˆ˜ì²˜ëŸ¼ í˜¸ì¶œí•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„.
      Stored Procedure ë¥¼ ì‚¬ìš©í•˜ë©´ ì—°ì†ë˜ëŠ” query ë¬¸ì— ëŒ€í•´ì„œ ë§¤ìš° ë¹ ë¥¸ ì„±ëŠ¥ì„ ë³´ì´ë©°, 
      ì½”ë“œì˜ ë…ë¦½ì„±ê³¼ í•¨ê»˜ ë³´ì•ˆì ì¸ ì¥ì ë„ ê°€ì§€ê²Œ ëœë‹¤. 
 
 create or replace procedure pcd_student_select_one 
    (p_stno         in  tbl_student.stno%type
    ,o_stno         out tbl_student.stno%type
    ,o_name         out tbl_student.name%type
    ,o_tel          out tbl_student.tel%type
    ,o_addr         out tbl_student.addr%type
    ,o_registerdate out tbl_student.registerdate%type
    ,o_classno      out tbl_class.classno%type
    ,o_classname    out tbl_class.classname%type
    ,o_teachername  out tbl_class.teachername%type)
    
    is
        v_cnt   number(1);
        
    begin
        select count(*) into v_cnt
        from tbl_student
        where stno = p_stno;
        
        if v_cnt = 0 then
            o_name := null;
            o_tel := null;
            o_addr := null;
            o_registerdate := null;
            o_classno := null;
            o_classname := null;
            o_teachername := null;
        else
            select stno, name, tel, addr, to_char(registerdate, 'yyyy-mm-dd') as registerday, fk_classno, classname, teachername
            into o_stno, o_name, o_tel, o_addr, o_registerdate, o_classno, o_classname, o_teachername
            from tbl_student S join tbl_class C
            on s.fk_classno = c.classno
            where stno = p_stno;
        end if;
        
    end pcd_student_select_one; 
 
 */

public class Procedure_select_one_CallableStatement_02 {

	public static void main(String[] args) {
		
		Connection conn = null;
		
		CallableStatement cstmt = null;
		// CallableStatement cstmt ì€ Connection conn(ì—°ê²°í•œ DB ì„œë²„)ì— ì¡´ì¬í•˜ëŠ” Procedure ë¥¼ í˜¸ì¶œí•´ì£¼ëŠ” ê°ì²´(ìš°í¸ë°°ë‹¬ë¶€)ì´ë‹¤.
		
		try {
				Class.forName("oracle.jdbc.driver.OracleDriver");
				

				conn = DriverManager.getConnection("jdbc:oracle:thin:@127.0.0.1:1521:xe", "JDBC_USER", "gclass");
				
				
				// >>> 3. Connection conn ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ prepareCall() ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•¨ìœ¼ë¡œì¨
		        //        CallableStatement cstmt ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
		        //        ì¦‰, ìš°í¸ë°°ë‹¬ë¶€(íƒë°°ê¸°ì‚¬) ê°ì²´ ë§Œë“¤ê¸°
				cstmt = conn.prepareCall("{call pcd_student_select_one(?,?,?,?,?,?,?,?,?)}");
				/*
					 ì˜¤ë¼í´ ì„œë²„ì— ìƒì„±í•œ í”„ë¡œì‹œì € pcd_student_select_one ì˜ 
	            	 ë§¤ê°œë³€ìˆ˜ ê°¯ìˆ˜ê°€ 9ê°œ ì´ë¯€ë¡œ ? ë¥¼ 9ê°œ ì¤€ë‹¤.
	            	 
	            	 ë‹¤ìŒìœ¼ë¡œ ì˜¤ë¼í´ì˜ í”„ë¡œì‹œì €ë¥¼ ìˆ˜í–‰( executeUpdate() ë˜ëŠ” execute() ) í•˜ê¸°ì— ì•ì„œì„œ  
					ë°˜ë“œì‹œ í•´ì•¼í•  ì¼ì€ IN mode ë¡œ ë˜ì–´ì§„ íŒŒë¼ë¯¸í„°ì— ê°’ì„ ë„£ì–´ì£¼ê³ ,
					OUT mode ë¡œ ì„¤ì •ëœ ê³³ì— ê·¸ ê²°ê³¼ê°’ì„ ë°›ì•„ì˜¤ë„ë¡ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•´ì•¼ í•œë‹¤.
					
					í”„ë¡œì‹œì €ì˜ IN mode ë¡œ ë˜ì–´ì§„ íŒŒë¼ë¯¸í„°ì— ê°’ì„ ë„£ì–´ì¤„ë•ŒëŠ” 
					cstmt.setXXX() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•œë‹¤. 
					
					í”„ë¡œì‹œì €ì˜ OUT mode ë¡œ ë˜ì–´ì§„ íŒŒë¼ë¯¸í„°ì— ì €ì¥ë˜ì–´ì§„ ê°’ì„ ìë°”ì—ì„œ êº¼ë‚´ ì˜¤ë ¤ë©´ 
					cstmt.registerOutParameter() ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•œë‹¤.
					
					â€» registerOutParameter() ë©”ì†Œë“œëŠ”?
					==> public void registerOutParameter(int parameterIndex, int sqlType) throws SQLException 
					    : í”„ë¡œì‹œì €ë¥¼ ì‹¤í–‰í•˜ì—¬ ë°›ì•„ì˜¨ ê°’ì„ JDBCíƒ€ì…(ìë°”ì—ì„œ ì¸ì‹í•˜ëŠ” íƒ€ì…)ìœ¼ë¡œ ë“±ë¡ì‹œì¼œì£¼ëŠ” ë©”ì†Œë“œì´ë‹¤.
					 
					 ìë°”ì—ì„œëŠ” ì˜¤ë¼í´ì˜ OUT mode ë³€ìˆ˜ì— ì˜¤ë¼í´ ë°ì´í„°íƒ€ì…ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆëŠ” ê°’ë“¤ì„ ì½ì–´ì™€ì„œ
					 JDBCíƒ€ì…(ìë°”ì—ì„œ ì¸ì‹í•˜ëŠ” íƒ€ì…)ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” ê³¼ì •ì„ ê±°ì³ì•¼ë§Œ í•œë‹¤.
					 ëŒ€í‘œì ì¸ sqlTypeì„ ì•Œì•„ë³´ë©´ NULL, FLOAT, INTEGER, VARCHAR, DATE, CLOB, BLOB ë“±ì´ ìˆë‹¤.
						 
				 */
				
				Scanner sc = new Scanner(System.in);
				System.out.print("ğŸ˜ í•™ë²ˆ : ");
				String stno = sc.nextLine();
				
				
				
				
				
				
				
				sc.close();
				
				
			} catch (ClassNotFoundException e) {
				System.out.println(">>> ojdbc8.jar íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. <<<");
			} catch (SQLException e) {
				e.printStackTrace();
			}
		
		System.out.println("(((o(*ï¾Ÿâ–½ï¾Ÿ*)o)))í”„ë¡œê·¸ë¨ ì¢…ë£Œ");
	}//-----------------------------------end of main

}
