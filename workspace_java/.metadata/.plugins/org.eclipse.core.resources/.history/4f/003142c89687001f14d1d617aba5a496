package jdbc.day01;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.Scanner;

public class DQL_select_where_PreparedStatement_3 {

	public static void main(String[] args) {

		
		Connection conn = null;
		// Connection conn μ€ λ°μ΄ν„°λ² μ΄μ¤ μ„λ²„μ™€ μ—°κ²°μ„ λ§Ίμ–΄μ£Όλ” μλ°”μ κ°μ²΄μ΄λ‹¤.
		
		PreparedStatement pstmt = null;
		//PreparedStatement pstmt μ€ Connection conn(μ—°κ²°ν•΄μ„ μ‚¬μ©ν•  DB μ„λ²„)μ— μ „μ†΅ν•  SQLλ¬Έ(νΈμ§€)μ„ μ „μ†΅(μ „λ‹¬)μ„ ν•΄μ£Όλ” κ°μ²΄(μ°νΈλ°°λ‹¬λ¶€)μ΄λ‹¤.
		
		ResultSet rs = null;
		//ResultSet rsμ€ select λμ–΄μ§„ κ²°κ³Όλ¬Όμ΄ μ €μ¥λμ–΄μ§€λ” κ³³.
		
		Scanner sc = new Scanner(System.in);

		
		try {
		// >>> 1. μ¤λΌν΄ λ“λΌμ΄λ²„ λ΅λ”© <<<
		/*
	        === OracleDriver(μ¤λΌν΄ λ“λΌμ΄λ²„)μ μ—­ν•  ===
	        1). OracleDriver λ¥Ό λ©”λ¨λ¦¬μ— λ΅λ”©μ‹μΌμ¤€λ‹¤.
	        2). OracleDriver κ°μ²΄λ¥Ό μƒμ„±ν•΄μ¤€λ‹¤.
	        3). OracleDriver κ°μ²΄λ¥Ό DriverManagerμ— λ“±λ΅μ‹μΌμ¤€λ‹¤.
	            --> DriverManager λ” μ—¬λ¬ λ“λΌμ΄λ²„λ“¤μ„ Vector μ— μ €μ¥ν•μ—¬ κ΄€λ¦¬ν•΄μ£Όλ” ν΄λμ¤μ΄λ‹¤.
		*/
			Class.forName("oracle.jdbc.driver.OracleDriver");
			
			
			// >>> 2. μ–΄λ–¤ μ¤λΌν΄ μ„λ²„μ— μ—°κ²°μ„ ν• λ? <<<
			
			System.out.print(" π«µμ—°κ²°ν•  μ¤λΌν΄ μ„λ²„μ IP μ£Όμ† : ");
			String ip = sc.nextLine(); // 127.0.0.1 //192.168.0.188 /191

			conn = DriverManager.getConnection("jdbc:oracle:thin:@" + ip + ":1521:xe", "JDBC_USER", "gclass");
			
			
			// >> 3.SQLλ¬Έ(νΈμ§€)μ„ μ‘μ„±ν•λ‹¤. <<
			String sql = " select no, name, msg, to_char(writeday, 'yyyy-mm-dd hh24:mi:ss') AS writeday " 
						+" from tbl_memo "
						+" order by no desc ";
			// SQL λ¬Έμ„ μ‘μ„±ν•  λ• 1μ¤„ λ§λ‹¤ μ•, λ’¤λ΅ κ³µλ°±μ„ κΌ­ μ£Όλ„λ΅ ν•λ‹¤. !! 
			// ; λ„£μΌλ©΄ μ¤λ¥

			// >>> 4. μ—°κ²°ν•  μ¤λΌν΄μ„λ²„(conn)μ— SQLλ¬Έ(νΈμ§€)μ„ μ „λ‹¬ν•  κ°μ²΄ PreparedStatement κ°μ²΄ (μ°νΈλ°°λ‹¬λ¶€) μƒμ„±ν•κΈ° <<<
			pstmt = conn.prepareStatement(sql);
			
			// >>> 5. PreparedStatement κ°μ²΄ (μ°νΈλ°°λ‹¬λ¶€)λ” μ‘μ„±λ„λ‹ sqlλ¬Έ(νΈμ§€)μ„ μ¤λΌν΄ μ„λ²„μ— λ³΄λ‚΄μ„ μ‹¤ν–‰μ΄ λλ„λ΅ ν•΄μ•Ό ν•λ‹¤.
			rs = pstmt.executeQuery(); //sqlλ¬Έ μ‹¤ν–‰
			
			/*
			 * SQLλ¬Έμ΄ DQL(select) μ΄λ―€λ΅ .executeQuery(); μ„ μ‚¬μ©ν•΄μ•Ό ν•λ‹¤. 
			 */
			
			System.out.println("-".repeat(40));
			System.out.println("κΈ€λ³ΈνΈ\tκΈ€μ“΄μ΄\tκΈ€λ‚΄μ©\tμ‘μ„±μΌμ");
			System.out.println("-".repeat(40));
			
			/*
            === μΈν„°νμ΄μ¤ ResultSet μ μ£Όμ”ν• λ©”μ†λ“ ===
            1. next()  : select λμ–΄μ§„ κ²°κ³Όλ¬Όμ—μ„ μ»¤μ„λ¥Ό λ‹¤μμΌλ΅ μ®κ²¨μ£Όλ” κ²ƒ         λ¦¬ν„΄νƒ€μ…μ€ boolean 
            2. first() : select λμ–΄μ§„ κ²°κ³Όλ¬Όμ—μ„ μ»¤μ„λ¥Ό κ°€μ¥ μ²μμΌλ΅ μ®κ²¨μ£Όλ” κ²ƒ     λ¦¬ν„΄νƒ€μ…μ€ boolean
            3. last()  : select λμ–΄μ§„ κ²°κ³Όλ¬Όμ—μ„ μ»¤μ„λ¥Ό κ°€μ¥ λ§μ§€λ§‰μΌλ΅ μ®κ²¨μ£Όλ” κ²ƒ    λ¦¬ν„΄νƒ€μ…μ€ boolean
            
            == μ»¤μ„κ°€ μ„μΉν• ν–‰μ—μ„ μ»¬λΌμ κ°’μ„ μ½μ–΄λ“¤μ΄λ” λ©”μ†λ“ ==
            getInt(μ«μ) : μ»¬λΌμ νƒ€μ…μ΄ μ«μμ΄λ©΄μ„ μ •μλ΅ μ½μ–΄λ“¤μ΄λ•
                          νλΌλ―Έν„° μ«μλ” μ»¬λΌμ μ„μΉκ°’ 
                          
            getInt(λ¬Έμ) : μ»¬λΌμ νƒ€μ…μ΄ μ«μμ΄λ©΄μ„ μ •μλ΅ μ½μ–΄λ“¤μ΄λ•
                          νλΌλ―Έν„° λ¬Έμλ” μ»¬λΌλ… λλ” aliasλ… 
                           
            getLong(μ«μ) : μ»¬λΌμ νƒ€μ…μ΄ μ«μμ΄λ©΄μ„ μ •μλ΅ μ½μ–΄λ“¤μ΄λ•
                           νλΌλ―Έν„° μ«μλ” μ»¬λΌμ μ„μΉκ°’ 
                          
            getLong(λ¬Έμ) : μ»¬λΌμ νƒ€μ…μ΄ μ«μμ΄λ©΄μ„ μ •μλ΅ μ½μ–΄λ“¤μ΄λ•
                           νλΌλ―Έν„° λ¬Έμλ” μ»¬λΌλ… λλ” aliasλ…                
            
            getFloat(μ«μ) : μ»¬λΌμ νƒ€μ…μ΄ μ«μμ΄λ©΄μ„ μ‹¤μλ΅ μ½μ–΄λ“¤μ΄λ•
                            νλΌλ―Έν„° μ«μλ” μ»¬λΌμ μ„μΉκ°’ 
                          
            getFloat(λ¬Έμ) : μ»¬λΌμ νƒ€μ…μ΄ μ«μμ΄λ©΄μ„ μ‹¤μλ΅ μ½μ–΄λ“¤μ΄λ•
                            νλΌλ―Έν„° λ¬Έμλ” μ»¬λΌλ… λλ” aliasλ… 
                               
            getDouble(μ«μ) : μ»¬λΌμ νƒ€μ…μ΄ μ«μμ΄λ©΄μ„ μ‹¤μλ΅ μ½μ–΄λ“¤μ΄λ•
                             νλΌλ―Έν„° μ«μλ” μ»¬λΌμ μ„μΉκ°’ 
                          
            getDouble(λ¬Έμ) : μ»¬λΌμ νƒ€μ…μ΄ μ«μμ΄λ©΄μ„ μ‹¤μλ΅ μ½μ–΄λ“¤μ΄λ•
                             νλΌλ―Έν„° λ¬Έμλ” μ»¬λΌλ… λλ” aliasλ…    
                                 
            getString(μ«μ) : μ»¬λΌμ νƒ€μ…μ΄ λ¬Έμμ—΄λ΅ μ½μ–΄λ“¤μ΄λ•
                             νλΌλ―Έν„° μ«μλ” μ»¬λΌμ μ„μΉκ°’ 
                          
            getString(λ¬Έμ) : μ»¬λΌμ νƒ€μ…μ΄ λ¬Έμμ—΄λ΅ μ½μ–΄λ“¤μ΄λ•
                             νλΌλ―Έν„° λ¬Έμλ” μ»¬λΌλ… λλ” aliasλ…                                                        
         */
			
			
			StringBuilder sb = new StringBuilder();
			
			
			while(rs.next()) {
				/*
	               rs.next() λ” select λμ–΄μ§„ κ²°κ³Όλ¬Όμ—μ„ μ„μΉ(ν–‰μ μ„μΉ)λ¥Ό λ‹¤μμΌλ΅ μ®κΈ΄ ν›„ 
	               ν–‰μ΄ μ΅΄μ¬ν•λ©΄ true λ¥Ό λ¦¬ν„΄ν•΄μ£Όκ³ , ν–‰μ΄ μ—†μΌλ©΄ false λ¥Ό λ¦¬ν„΄ν•΄μ£Όλ” λ©”μ†λ“μ΄λ‹¤.
	            */
				
				//rs.getInt(1); // 1 μ€ select ν•΄μ¨ μ»¬λΌμ μ„μΉκ°’μΌλ΅μ¨ 1λ²μ§Έ μ»¬λΌμ„ κ°€λ¦¬ν‚¤λ” κ²ƒμ΄λ‹¤.
				//λλ”
				//rs.getInt("NO"); //"NO"λ”  select ν•΄μ¨ μ»¬λΌλ…μ΄λ‹¤.
				//λλ”
				int no = rs.getInt("no"); //"no"λ”  select ν•΄μ¨ μ»¬λΌλ…μ΄λ‹¤.
				
				//rs.getInt(2); // 2 μ€ select ν•΄μ¨ μ»¬λΌμ μ„μΉκ°’μΌλ΅μ¨ 2λ²μ§Έ μ»¬λΌμ„ κ°€λ¦¬ν‚¤λ” κ²ƒμ΄λ‹¤.
				//λλ”
				//rs.getInt("NAME"); //"NO"λ”  select ν•΄μ¨ μ»¬λΌλ…μ΄λ‹¤.
				//λλ”
				String name = rs.getString("name"); //"name"λ”  select ν•΄μ¨ μ»¬λΌλ…μ΄λ‹¤.
				
				
				//rs.getInt(3); // 3 μ€ select ν•΄μ¨ μ»¬λΌμ μ„μΉκ°’μΌλ΅μ¨ 3λ²μ§Έ μ»¬λΌμ„ κ°€λ¦¬ν‚¤λ” κ²ƒμ΄λ‹¤.
				//λλ”
				//rs.getInt("MSG"); //"NO"λ”  select ν•΄μ¨ μ»¬λΌλ…μ΄λ‹¤.
				//λλ”
				String msg = rs.getString("msg"); //"msg"λ”  select ν•΄μ¨ μ»¬λΌλ…μ΄λ‹¤.
				
				//rs.getInt(4); // 3 μ€ select ν•΄μ¨ μ»¬λΌμ μ„μΉκ°’μΌλ΅μ¨ 3λ²μ§Έ μ»¬λΌμ„ κ°€λ¦¬ν‚¤λ” κ²ƒμ΄λ‹¤.
				//λλ”
				//rs.getInt("WRITEDAY"); //"WRITEDAY"λ”  select ν•΄μ¨ μ»¬λΌλ…μ΄λ‹¤.
				//λλ”
				String writeday = rs.getString("writeday"); //"writeday"λ”  select ν•΄μ¨ μ»¬λΌλ…μ΄λ‹¤.
				
				
				sb.append(no);
				sb.append("\t"+name);
				sb.append("\t"+msg);
				sb.append("\t"+writeday+"\n");
				
				
				
				
			}// end of while ----------------------------------------
			
			
			System.out.println(sb.toString());

			
			
			// ==== StringBUilder sb λ¥Ό μ΄κΈ°ν™” ν•κΈ° ==== //
			//sb = new StringBuilder();
			//λλ”
			sb.setLength(0);
			
			
			
			sb.append("-------------->>> μ΅°νν•  λ€μƒ <<<---------------\n");
			sb.append("1.κΈ€λ²νΈ   2.κΈ€μ“΄μ΄   3.κΈ€λ‚΄μ©   4.μ‘μ„±μΌμ   5.μΆ…λ£\n");
			sb.append("---------------------------------------------\n");
			
			
			String menu = sb.toString();
			
			
			String menuNo = null;
			
			do {
				/////////////////////////////////////////////////////////
				System.out.println(menu);
				System.out.print("π¤λ²νΈ μ„ νƒ : ");
				menuNo = sc.nextLine();
				
				
				switch (menuNo) {
				case "1":	//κΈ€λ²νΈ

					break;
				case "2":	//κΈ€μ“΄μ΄

					break;
				case "3":	//κΈ€λ‚΄μ©

					break;
				case "4":	//μ‘μ„±μΌμ

					break;
				case "5":	//μΆ…λ£

					break;

				default:
					System.out.println("~~~ λ©”λ‰΄μ— μ—†λ” λ²νΈ μ…λ‹λ‹¤. ~~~");
					continue;
				}//--------------------------------------end of switch----------------------------
				
				System.out.println("==[μ£Όμ] μ‘μ„±μΌμ κ²€μƒ‰μ΄λΌλ©΄ 2024-10-11μ™€ κ°™μ΄ μ…λ ¥ν•μ„Έμ” ==");
				System.out.print("π«΅ κ²€μƒ‰μ–΄ : ");
				
				sql = " select no, name, msg, to_char(writeday, 'yyyy-mm-dd hh24:mi:ss') AS writeday " 
						+" from tbl_memo "
						+" where name "
						+" order by no desc ";
				
				
				/////////////////////////////////////////////////////////
			} while (!("5".equals(menuNo)));

		} catch (ClassNotFoundException e) {
			System.out.println(">>> ojdbc8.jar νμΌμ΄ μ—†μµλ‹λ‹¤. <<<");
		} catch(SQLException e) {
			e.printStackTrace();
		} finally {
			try {
				if(rs != null) {
					rs.close();
					rs = null;
				}
				
				if(pstmt != null) {
					pstmt.close();
					pstmt = null;
				}
				
				if(conn != null) {
					conn.close();
					conn = null;
				}
				
			} catch (SQLException e) {
				e.printStackTrace();
			}
		}
		
		
	}// end of main()-----------------------------

}
